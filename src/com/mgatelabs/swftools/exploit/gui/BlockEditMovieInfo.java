package com.mgatelabs.swftools.exploit.gui;

import com.mgatelabs.swftools.support.swf.objects.FMovie;
import com.mgatelabs.swftools.support.tools.JPanelMaker;

import javax.swing.*;
import javax.swing.border.TitledBorder;

public class BlockEditMovieInfo extends JPanel {
    private FMovie myMovie;
    private JTextField myFPSField;
    private JTextField myMaxXField;
    private JTextField myMaxYField;
    private JTextField myMinXField;
    private JTextField myMinYField;
    private JTextField myVersionField;

    public BlockEditMovieInfo() {
        super();
        buildControls();
        buildGui();
    }

    public void buildControls() {
        myMaxXField = new JTextField(8);
        myMaxYField = new JTextField(8);
        myMinXField = new JTextField(8);
        myMinYField = new JTextField(8);
        myFPSField = new JTextField(8);
        myVersionField = new JTextField(8);
        myVersionField.setEnabled(false);
    }

    public void buildGui() {
        this.setLayout(new BoxLayout(this, BoxLayout.Y_AXIS));

        JLabel labelFps = new JLabel("FPS");
        JLabel labelVer = new JLabel("Version");
        JLabel labelMaxX = new JLabel("Max X");
        JLabel labelMaxY = new JLabel("Max Y");
        JLabel labelMinX = new JLabel("Min X");
        JLabel labelMinY = new JLabel("Min X");

        JPanel panelFPS = JPanelMaker.YPanel(300, 75);

        TitledBorder titleFps;
        titleFps = BorderFactory.createTitledBorder("Movie Info");
        panelFPS.setBorder(titleFps);

        panelFPS.add(JPanelMaker.buildLayoutPanel(labelFps, myFPSField, 300, 80, 20));
        panelFPS.add(JPanelMaker.buildLayoutPanel(labelVer, myVersionField, 300, 80, 20));

        JPanel panelDimension = JPanelMaker.YPanel(300, 75);

        TitledBorder titleDimensions;
        titleDimensions = BorderFactory.createTitledBorder("Movie Dimensions");
        panelDimension.setBorder(titleDimensions);

        JPanel panelMinX = JPanelMaker.buildLayoutPanel(labelMinX, myMinXField, 145, 50, 20);
        JPanel panelMinY = JPanelMaker.buildLayoutPanel(labelMinY, myMinYField, 145, 50, 20);
        JPanel panelMaxX = JPanelMaker.buildLayoutPanel(labelMaxX, myMaxXField, 145, 50, 20);
        JPanel panelMaxY = JPanelMaker.buildLayoutPanel(labelMaxY, myMaxYField, 145, 50, 20);

        panelDimension.add(JPanelMaker.buildLayoutPanel(panelMinX, panelMinY, 300, 150, 20));
        panelDimension.add(JPanelMaker.buildLayoutPanel(panelMaxX, panelMaxY, 300, 150, 20));

        this.add(panelFPS);
        this.add(panelDimension);
    }

    public void update(FMovie aMovie) {
        myMovie = aMovie;
        myMinXField.setText("" + aMovie.getRect().xmin / 20);
        myMinYField.setText("" + aMovie.getRect().ymin / 20);
        myMaxXField.setText("" + aMovie.getRect().xmax / 20);
        myMaxYField.setText("" + aMovie.getRect().ymax / 20);
        myFPSField.setText("" + aMovie.getFrameRate());
        myVersionField.setText("" + aMovie.getVersion());
    }

    public FMovie get() {
        try {
            int minx = Integer.parseInt(myMinXField.getText()) * 20;
            int miny = Integer.parseInt(myMinYField.getText()) * 20;
            int maxx = Integer.parseInt(myMaxXField.getText()) * 20;
            int maxy = Integer.parseInt(myMaxYField.getText()) * 20;

            float fps = Float.parseFloat(myFPSField.getText());

            myMovie.getRect().xmax = maxx;
            myMovie.getRect().ymax = maxy;
            myMovie.getRect().xmin = minx;
            myMovie.getRect().ymin = miny;

            myMovie.setFrameRate(fps);

            return myMovie;
        } catch (Exception e) {
            return null;
        }
    }

    public void clear() {
        myMovie = null;
        myMinXField.setText("");
        myMinYField.setText("");
        myMaxXField.setText("");
        myMaxYField.setText("");
        myFPSField.setText("");
    }

}