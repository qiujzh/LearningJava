package com.mgatelabs.swftools.exploit.render;

import com.mgatelabs.swftools.support.swf.objects.FDisplayListItem;
import com.mgatelabs.swftools.support.swf.objects.FMovieData;
import com.mgatelabs.swftools.support.swf.objects.FShape;

import java.awt.geom.Area;
import java.awt.geom.GeneralPath;
import java.util.Vector;

public class Clipper {

    public static Area clip(Object a) {
        if (a instanceof FShape) {
            return clipShape((FShape) a, null);
        } else if (a instanceof FMovieData) {
            return clipMovie((FMovieData) a);
        } else if (a instanceof GeneralPath) {
            return clipPath((GeneralPath) a);
        }

        return new Area();
    }

    public static Area clipPath(GeneralPath a) {
        Area result = new Area();

        result.add(new Area(a));

        return result;
    }

    public static Area clipShape(FShape a, Vector data) {
        Area result = new Area();

        if (data == null) {
            data = a.getRenderData();
        }

        for (int x = 0; x < data.size(); x++) {
            AdvancedPath ap = (AdvancedPath) data.get(x);

            if (ap.getLine() != null) {
                result.add(new Area(ap.getLine().getStroke().createStrokedShape(ap.getPath())));
            } else if (ap.getFill() != null) {
                result.add(new Area(ap.getPath()));
            }
        }

        return result;
    }

    public static Area clipMovie(FMovieData a) {

        Area result = new Area();
        Vector list = a.getDisplayList();

        for (int x = 0; x < list.size(); x++) {
            FDisplayListItem di = (FDisplayListItem) list.get(x);
            if (di == null) {
                continue;
            }

            Object data = di.getObject();

            if (data instanceof FShape) {
                result.add(clipShape((FShape) data, null));
            }
            //    else if (data instanceof FMorph)
            // {
            // result.add( clipShape((FShape) data, null ) );
            // }
            else if (data instanceof FMovieData) {
                result.add(clipMovie((FMovieData) data));
            }
        }

        //result.closePath();

        return result;

    }
}